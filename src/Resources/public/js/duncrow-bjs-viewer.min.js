function __awaiter(e,t,i,s){function n(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,a){function o(e){try{c(s.next(e))}catch(e){a(e)}}function r(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):n(e.value).then(o,r)}c((s=s.apply(e,t||[])).next())})}class DCCamera{constructor(e){this._scene=e,this._canvas=this._scene.canvas,this._cameraSettings=this._scene.cameraSettings,this._camera=new BABYLON.ArcRotateCamera("Camera-"+this._scene.id,0,0,0,BABYLON.Vector3.Zero(),this._scene.scene),this._usedMeshesList=this._scene.usedMeshesList,this._camera.attachControl(this._canvas),this._camera.setPosition(new BABYLON.Vector3(0,1,2)),this._camera.alpha=1,this._camera.useFramingBehavior=!0;const t=Math.PI/180;this._cameraSettings&&(this._cameraSettings.radius&&(this._camera.radius=this._cameraSettings.radius),this._cameraSettings.upperVerticalAngelLimit&&(this._camera.lowerBetaLimit=Math.PI/2-t*this._cameraSettings.upperVerticalAngelLimit),this._cameraSettings.lowerVerticalAngelLimit&&(this._camera.upperBetaLimit=Math.PI/2+t*this._cameraSettings.lowerVerticalAngelLimit),this._cameraSettings.upperHorizontalAngelLimit&&(this._camera.upperAlphaLimit=this._camera.alpha+t*this._cameraSettings.upperHorizontalAngelLimit),this._cameraSettings.lowerHorizontalAngelLimit&&(this._camera.lowerAlphaLimit=this._camera.alpha+t*this._cameraSettings.lowerHorizontalAngelLimit),this._cameraSettings.panningSensibility&&(this._camera.panningSensibility=this._cameraSettings.panningSensibility),this._cameraSettings.wheelPrecision&&(this._camera.wheelPrecision=this._cameraSettings.wheelPrecision),this._cameraSettings.useAutoRotationBehavior&&(this._camera.useAutoRotationBehavior=this._cameraSettings.useAutoRotationBehavior),this._cameraSettings.rotationSpeed&&(this._camera.autoRotationBehavior.idleRotationSpeed=this._cameraSettings.rotationSpeed),this._cameraSettings.minZ&&(this._camera.minZ=this._cameraSettings.minZ),this._cameraSettings.maxZ&&(this._camera.maxZ=this._cameraSettings.maxZ)),this._initCameraPosition=this._camera.position}get camera(){return this._camera}set camera(e){this._camera=e}get initCameraPosition(){return this._initCameraPosition}set initCameraPosition(e){this._initCameraPosition=e}attachControl(){this._camera.attachControl(this._canvas,!0)}setCameraTarget(e){this._sceneTargets=e,this._camera.focusOn(e,!0),this._camera.zoomOn(e,!0),this._cameraSettings&&this._camera.radius&&(this._cameraSettings.minZoom&&(this._camera.lowerRadiusLimit=this._camera.radius*this._cameraSettings.minZoom),this._cameraSettings.maxZoom&&(this._camera.upperRadiusLimit=this._camera.radius*this._cameraSettings.maxZoom)),this._initAlpha=Object.assign({},this._camera).alpha,this._initBeta=Object.assign({},this._camera).beta,this._initRadius=Object.assign({},this._camera).radius,this._initTarget=this._camera.target.clone()}targAnimEnded(){}animateCameraTargetToPosition(e,t,i,s,n="target"){var a=new BABYLON.CubicEase;a.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT);var o=s;void 0!==s.x&&(o=new BABYLON.Vector3(-s.x,s.y,s.z)),BABYLON.Animation.CreateAndStartAnimation("at5",e,n,t,i,e[n],o,0,a,this.targAnimEnded)}refocusCamera(e){var t=this._sceneTargets;e&&(t=e);var i=200,s=200;this.animateCameraTargetToPosition(this._camera,i,s,t[0].position),!e&&this._cameraSettings&&this._camera.radius&&(this._cameraSettings.minZoom&&(this._camera.lowerRadiusLimit=this._camera.radius*this._cameraSettings.minZoom),this._cameraSettings.maxZoom&&(this._camera.upperRadiusLimit=this._camera.radius*this._cameraSettings.maxZoom))}zoomOnMeshes(e=null){var t=e;e&&e.length||(t=this._scene.scene.meshes.filter(e=>this._usedMeshesList.indexOf(e.id)>-1),t&&t.length||(t=this._sceneTargets));const i=new BABYLON.FramingBehavior;i.framingTime=750,this._camera.addBehavior(i),i.zoomOnMeshesHierarchy(t)}resetCamera(){var e=90,t=this.setCameraAnimation("radius",this._initRadius,e),i=this.setCameraAnimation("alpha",this._initAlpha,e),s=this.setCameraAnimation("beta",this._initBeta,e),n=this.setCameraAnimation("target",this._initTarget,e);this._scene.scene.beginDirectAnimation(this._camera,[t,i,s,n],0,e,!1)}setCameraAnimation(e,t,i){let s=new BABYLON.Animation(e+"Animation",e,i,"target"==e?BABYLON.Animation.ANIMATIONTYPE_VECTOR3:BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);var n=new BABYLON.CircleEase;n.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),s.setEasingFunction(n);let a=[];return a.push({frame:0,value:"target"==e?this._camera[e].clone():this._camera[e]}),a.push({frame:i,value:t}),s.setKeys(a),s}}class DCEnvironmentHelper{constructor(e,t){if(t){let i={createGround:this.parseValue(t,"createGround",!0),groundSize:this.parseValue(t,"groundSize",50),createSkybox:this.parseValue(t,"createSkybox",!0),skyboxSize:this.parseValue(t,"skyboxSize",400),skyboxColor:this.parseValue(t,"skyboxColor",BABYLON.Color3.Gray()),groundColor:this.parseValue(t,"groundColor",BABYLON.Color3.White()),groundShadowLevel:this.parseValue(t,"groundShadowLevel",0),setupImageProcessing:this.parseValue(t,"setupImageProcessing",!1),cameraContrast:this.parseValue(t,"cameraContrast",1.6),cameraExposure:this.parseValue(t,"cameraExposure",.6)};this._environment=e.createDefaultEnvironment(i),void 0!==t.backgroundColor&&(e.clearColor=t.backgroundColor)}}parseValue(e,t,i){return t in e?null==e[t]?null:e[t]:i}}var DC_GUI_TYPE,DC_INFOPOINTS_TYPE;(function(e){e[e.ShowHideElements=0]="ShowHideElements",e[e.AnimationElements=1]="AnimationElements",e[e.CustomElements=2]="CustomElements"})(DC_GUI_TYPE||(DC_GUI_TYPE={}));class DCGui{constructor(e,t,i,s=DC_GUI_TYPE.ShowHideElements,n=null,a=null){var o,r,c,l,h,d,m,u,_,g,v,p,C,S,f,b;this._class="show-hide-checkbox",this._scene=e,this._container=t,this._id=i;var w="input";if(s==DC_GUI_TYPE.ShowHideElements){w="input";var L=this._scene.scene.meshes.filter(e=>this._scene.usedMeshesList.indexOf(e.id)>-1);if(L.length){this._showHideAllId="dc-"+this._id+"-showhide-all",this.createElement(w,this._showHideAllId,"show-hide-all");for(let e=0;e<L.length;e++){var E="dc-"+this._id+"-showhide-"+e;this.createElement(w,E,L[e].name)}}}else if(s==DC_GUI_TYPE.AnimationElements){w="button",this._class="play-stop-animation";var A=this._scene.scene.animationGroups;if(A.length)for(let e=0;e<A.length;e++){E="dc-"+this._id+"-animation-"+e;this.createElement(w,E,A[e].name,null,e)}this._scene.scene.animationGroups.forEach((e,t)=>{e.metadata="test",e.onAnimationEndObservable.add((e,t)=>{var i=e.animation.name.replace(/(_channel[0-9]*)/,""),s=this._scene.scene.animationGroups.indexOf(this._scene.scene.animationGroups.find(e=>e.name==i));if(s>-1){var n=this._container.querySelectorAll("."+this._class);n[s].classList.remove("playing")}})})}else if(s==DC_GUI_TYPE.CustomElements&&n.options.length){var y=document.createElement("div");y.classList.add("dc-scroll-main-container-"+this._id),y.classList.add("dc-scroll-main-container"),void 0!==n.infopointType&&y.setAttribute("dc-controll-type",n.infopointType),void 0!==n.id&&y.setAttribute("dc-controll-id",n.id);var k=document.createElement("label");if(void 0!==n.title&&k.appendChild(document.createTextNode(n.title)),void 0===n.type||"checkbox"!=n.type){var O=document.createElement("div");O.className="dc-scroll-container hidden";var P=document.createElement("div");P.classList.add("inner");var I=document.createElement("div");I.className="dc-selected";var T=document.createElement("div");T.className="swiper";var B=document.createElement("div");B.className="swiper-wrapper";for(let e=0;e<5;e++)if(n&&void 0!==n.options&&n.options.length)for(let e=0;e<n.options.length;e++){var M=document.createElement("div");M.className="swiper-slide swiper-element-"+e,M.innerHTML='<div class="inner">'+((null===(o=n.options[e])||void 0===o?void 0:o.background)?`<div class="dc-swiper-symbol background-container ${(null===(r=n.options[e])||void 0===r?void 0:r.backgroundType)?"type-"+(null===(c=n.options[e])||void 0===c?void 0:c.backgroundType):""}"><div class="inner" style="background: ${n.options[e].background}" /></div></div>`:"")+((null===(l=n.options[e])||void 0===l?void 0:l.imagePath)?`<div class="dc-swiper-symbol image-container"><img src="${n.options[e].imagePath}" /></div>`:"")+`<div class="text-container"><span>${null===(h=n.options[e])||void 0===h?void 0:h.text}</span></div>`+"</div>",void 0!==n.options[e].action&&void 0!==n.options[e].action.change&&void 0!==n.options[e].action.target&&(M.setAttribute("dc-type",n.options[e].action.change),M.setAttribute("dc-target",n.options[e].action.target),void 0!==n.options[e].action.limitMeshes&&M.setAttribute("dc-limitmeshes",n.options[e].action.limitMeshes),void 0!==n.options[e].action.set&&M.setAttribute("dc-target-set",n.options[e].action.set)),B.appendChild(M)}this._container.appendChild(y),y.appendChild(O),y.appendChild(k),y.appendChild(I);var x=k.cloneNode(!0);x.classList.add("dc-swiper-label"),x.innerHTML=x.innerHTML+'<div class="dc-btn-close close-dc-select">&#10006;</div>',O.appendChild(x),O.appendChild(P),P.appendChild(T),T.appendChild(B);var N=y.querySelector(" .dc-selected");N.addEventListener("click",e=>{Array.from(y.querySelectorAll(" .dc-scroll-container")).forEach(e=>e.classList.add("hidden"));var t=y.querySelector(" .dc-scroll-container");t.classList.remove("hidden"),a(y)},!1)}else if((null===(d=null==n?void 0:n.options)||void 0===d?void 0:d.length)&&(null==n?void 0:n.options[0])&&(null==n?void 0:n.options[1])&&void 0!==(null===(m=null==n?void 0:n.options[0])||void 0===m?void 0:m.imagePath)&&void 0!==(null===(u=null==n?void 0:n.options[1])||void 0===u?void 0:u.imagePath)){var D=this.createElement("input","dc-checkbox-"+this._id,null==n?void 0:n.title,{checkedImagePath:null===(_=null==n?void 0:n.options[0])||void 0===_?void 0:_.imagePath,uncheckedImagePath:null===(g=null==n?void 0:n.options[1])||void 0===g?void 0:g.imagePath});void 0!==(null===(p=null===(v=null==n?void 0:n.options[0])||void 0===v?void 0:v.action)||void 0===p?void 0:p.target)&&D.setAttribute("dc-target",n.options[0].action.target),void 0!==(null===(S=null===(C=null==n?void 0:n.options[0])||void 0===C?void 0:C.action)||void 0===S?void 0:S.set)&&D.setAttribute("dc-target-set-checked",n.options[0].action.set),void 0!==(null===(b=null===(f=null==n?void 0:n.options[1])||void 0===f?void 0:f.action)||void 0===b?void 0:b.set)&&D.setAttribute("dc-target-set-unchecked",n.options[1].action.set);var Y=D.closest(".dc-checkbox-container");void 0!==n.infopointType&&Y.setAttribute("dc-controll-type",n.infopointType),void 0!==n.id&&Y.setAttribute("dc-controll-id",n.id),Y.classList.remove("unchecked","checked"),Y.classList.add(D.checked?"checked":"unchecked"),D.addEventListener("change",e=>{var t,i,s,o,r,c;void 0!==(null===(i=null===(t=null==n?void 0:n.options[0])||void 0===t?void 0:t.action)||void 0===i?void 0:i.target)&&void 0!==(null===(o=null===(s=null==n?void 0:n.options[0])||void 0===s?void 0:s.action)||void 0===o?void 0:o.set)&&void 0!==(null===(c=null===(r=null==n?void 0:n.options[1])||void 0===r?void 0:r.action)||void 0===c?void 0:c.set)&&(this._scene.scene.getMeshById(null==n?void 0:n.options[0].action.target).isVisible=D.checked),Y.classList.remove("unchecked","checked"),Y.classList.add(D.checked?"checked":"unchecked"),a(Y)},!1),this._container.appendChild(y),y.appendChild(k),y.appendChild(Y)}}}openGuiSlider(e,t,i=null,s=null,n=null){Array.from(this._container.querySelectorAll(".dc-scroll-container")).forEach(e=>e.classList.add("hidden"));var a,o=Array.from(this._container.querySelectorAll('[dc-controll-type="'+t+'"][dc-controll-id="'+e+'"] .dc-scroll-container'));o.length&&(a=o[0],s&&n&&(a.style.left=s+"px",a.style.top=n+"px",a.style.position="fixed",a.style.width="250px",a.style.transform="none"),a.classList.remove("hidden"),i(a.closest(".dc-scroll-main-container")))}createElement(e,t,i,s=null,n=0){var a,o,r=document.createElement(e);if(r.type="input"==e?"checkbox":"button",r.classList.add(t),r.classList.add(this._class),r.name=t,r.value=i,s){if(r.checked=!0,void 0!==s.checkedImagePath&&s.checkedImagePath){a=document.createElement("div"),a.classList.add("dc-image-container");var c=document.createElement("img");c.src=s.checkedImagePath,a.classList.add("checked-image"),a.appendChild(c)}if(void 0!==s.uncheckedImagePath&&s.uncheckedImagePath){o=document.createElement("div"),o.classList.add("dc-image-container");var l=document.createElement("img");l.src=s.uncheckedImagePath,o.classList.add("unchecked-image"),o.appendChild(l)}}else"input"==e?(r.checked=!0,r.addEventListener("change",e=>this.hideShowElements(e),!1)):"button"==e&&(r.textContent=i,r.addEventListener("click",e=>this.animationStartStop(e,n),!1));var h=document.createElement("span");h.appendChild(document.createTextNode(i));var d=document.createElement("label");d.appendChild(h);var m=document.createElement("div");return m.classList.add(t+"-container"),m.classList.add("dc-checkbox-container"),d.appendChild(r),a&&d.appendChild(a),o&&d.appendChild(o),m.appendChild(d),r}hideShowElements(e){var t=this._scene.scene.meshes,i=this._container.querySelectorAll("."+this._class);if(e.target.className.includes(this._showHideAllId)){t.map(t=>t.isVisible=e.target.checked);for(var s=0;s<i.length;s++)i[s].checked=e.target.checked}else for(s=0;s<i.length;s++)"show-hide-all"!=i[s].value&&(t.find(e=>e.id==i[s].value).isVisible=i[s].checked)}animationStartStop(e,t){this._scene.scene.animationGroups.forEach((e,i)=>{i!=t&&e.stop()});var i=this._scene.scene.animationGroups[t];i.isStarted?(i.stop(),e.target.classList.remove("playing")):(i.play(!(2==t)),e.target.classList.add("playing"))}}(function(e){e.visibility="visibility",e.zoom="zoom",e.info="info",e.color="color"})(DC_INFOPOINTS_TYPE||(DC_INFOPOINTS_TYPE={}));class DCInfopoints{constructor(e,t,i,s,n=null){this._scene=e,this._advancedTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,this._scene.scene);for(let e=0;e<this._scene.scene.meshes.length;e++){var a=this._scene.scene.meshes[e];if(a.id.includes(t)){a.isVisible=!1;let e="",t=i.indexOf(i.find(e=>a.id.includes(e.meshNamePattern)));t>-1&&(e=i[t].imagePath);var o=BABYLON.GUI.Button.CreateImageButton("dc-mesh-button-"+a.id,"",e);o.width=n&&(null==n?void 0:n.width)?n.width+"px":"54px",o.height=n&&(null==n?void 0:n.height)?n.height+"px":"54px",o.image.width=n&&(null==n?void 0:n.width)?n.width+"px":"54px",o.image.height=n&&(null==n?void 0:n.height)?n.height+"px":"54px",o.background="transparent",o.thickness=0,this._advancedTexture.addControl(o),o.linkWithMesh(a),this.bindButtonEvents(o,e,a,s,n)}}}get advancedTexture(){return this._advancedTexture}toggleVisibility(e=null){let t=this._advancedTexture.getDescendants();t.forEach(t=>{t.isVisible=!0===e||!1!==e&&!t.isVisible})}bindButtonEvents(e,t,i,s,n=null){var a=t.split(".").pop();e.onPointerEnterObservable.add(e=>{void 0!==e.image&&(e.image.source=t.replace("."+a,"")+"-hover."+a)}),e.onPointerOutObservable.add(e=>{void 0!==e.image&&(e.image.source=t)}),e.onPointerClickObservable.add(o=>{e.image.source=t.replace("."+a,"")+"-active."+a;var r="",c=[];const l=Object.keys(DC_INFOPOINTS_TYPE);if(l.forEach((e,t)=>{if(n&&void 0!==n[e]&&n[e].length&&n[e].filter(e=>i.id.includes(e)).length){r=i.id.replace(n[e].filter(e=>i.id.includes(e))[0]+"-","");var s=[DC_INFOPOINTS_TYPE[e]];c=[...new Set([...c,...s])]}}),c.includes(DC_INFOPOINTS_TYPE.zoom))for(let e=0;e<n.zoom.length;e++)if(i.id.includes(n.zoom[e])){var h=this._scene.camera;h.animateCameraTargetToPosition(h.camera,200,200,i.position),h.animateCameraTargetToPosition(h.camera,200,200,s,"radius")}if(c.includes(DC_INFOPOINTS_TYPE.visibility))for(let e=0;e<n.visibility.length;e++)if(i.id.includes(n.visibility[e])){var d=this._scene.scene.getMeshById(r);d&&(d.isVisible=!d.isVisible)}this.clickedInfopoint({mesh:i,targetMeshId:r,type:c,x:o.x,y:o.y})})}}class DCCameraSettingsModel{constructor(){this.panningSensibility=1e3,this.wheelPrecision=100,this.useAutoRotationBehavior=!1,this.rotationSpeed=.1}}class DCEnvironmentSettingsModel{constructor(){this.createGround=!1,this.groundSize=50,this.createSkybox=!1}}class DCGuiOptions{}class DCInfopointClickReturnModel{}class DCInfopointImagePathModel{}class DCInfopointOptionsModel{}class DCSceneSlot{constructor(e,t,i,s,n,a,o=null,r=!1,c=null){this.isFullscreen=!1,this.loadingStarted=new Promise((e,t)=>{this._startedResolve=e,this._startedReject=e}),this.loadingFinished=new Promise((e,t)=>{this._finishedResolve=e,this._finishedReject=e}),this.sceneCallbacks={addMaterial:function(e,t){for(let t of e._scene.materials)if(e!=t&&e.id==t.id)throw new Error("material with id already exists"+e.id)},addMesh:function(e,t){for(let t of e._scene.meshes)if(e!=t&&e.id==t.id)throw new Error("mesh with id already exists "+e.id)},addLight:function(e,t){for(let t of e._scene.lights)if(e!=t&&e.id==t.id)throw new Error("light with id already exists "+e.id)}},this._blacklist=["BackgroundHelper","BackgroundPlane","BackgroundSkybox"],this._whitelist=[],this._usedMeshesList=[],this._userInteractionEnabled=!0,this._sceneContainer=document.querySelector(t),this.startScene(i,e,s,r,o,a,n,c),this._scene.onReadyObservable.add((e,t)=>{this.setUsedMeshesList(),this._finishedResolve(),this._scene.animationGroups.forEach((e,t)=>{e.stop()})})}get sceneContainer(){return this._sceneContainer}get infopoints(){return this._infopoints}get gui(){return this._gui}get cameraSettings(){return this._cameraSettings}get environment(){return this._environment}get showFps(){return this._showFps}get engine(){return this._engine}get canvas(){return this._canvas}get scene(){return this._scene}get camera(){return this._camera}get id(){return this._id}get view(){return this._view}registersceneCallbacks(){this._scene.onNewMaterialAddedObservable.add(this.sceneCallbacks.addMaterial),this._scene.onNewMeshAddedObservable.add(this.sceneCallbacks.addMesh),this._scene.onNewLightAddedObservable.add(this.sceneCallbacks.addLight)}get blacklist(){return this._blacklist}set blacklist(e){e.length?(this._blacklist=[...new Set([...this._blacklist,...e])],this.setUsedMeshesList()):this._blacklist=[]}get whitelist(){return this._whitelist}set whitelist(e){e.length?(this._whitelist=[...new Set([...this._whitelist,...e])],this.setUsedMeshesList()):this._whitelist=[]}get usedMeshesList(){return this._usedMeshesList}set usedMeshesList(e){this._usedMeshesList=e}setUsedMeshesList(){this._usedMeshesList=[];var e=this._scene.meshes;if(e.length)for(let t=0;t<e.length;t++)this._whitelist.length&&!(this._whitelist.indexOf(e[t].id)>-1)||this._blacklist.length&&this._blacklist.find(i=>e[t].id.toLowerCase().includes(i.toLowerCase()))||this._usedMeshesList.push(e[t].id)}get userInteractionEnabled(){return this._userInteractionEnabled}set userInteractionEnabled(e){this._userInteractionEnabled=e,this._scene&&this._scene.activeCamera&&(this._userInteractionEnabled?this._scene.activeCamera.attachControl(this._canvas):this._scene.activeCamera.detachControl(this._canvas))}registerOnMeshSelection(e,t,i){this._scene.onPointerDown=((s,n)=>{if(e)if(this._highlightLayer.removeAllMeshes(),n.hit&&!this._blacklist.includes(n.pickedMesh.name)){if(e({meshName:n.pickedMesh.name,mouseAttributes:{x:s.clientX,y:s.clientY,mouseButton:s.button}}),t){const e=this._scene.meshes.find(e=>e.id==n.pickedMesh.id);i&&e&&this._camera.zoomOnMeshes([e]),this._highlightLayer.addMesh(e,t)}}else this._camera.zoomOnMeshes(),e({meshName:void 0,mouseAttributes:{x:s.clientX,y:s.clientY,mouseButton:s.button}});else n.hit&&!this._blacklist.includes(n.pickedMesh.name)||this._camera.zoomOnMeshes()})}unregisterOnMeshSelection(){this._scene.onPointerDown=null,this._highlightLayer.removeAllMeshes()}get backgroundColor(){return this._scene.clearColor}set backgroundColor(e){this._scene.clearColor=e}startScene(e,t,i,s,n,a,o,r){this._engine=e,this._canvas=t,this._id=i,this._showFps=s,this._environmentSettings=n,this._cameraSettings=a,this._assetsPath=o,this._registerOnMeshSelection=r,this._scene=new BABYLON.Scene(this._engine),this._scene.createDefaultLight(),this.registersceneCallbacks(),this._highlightLayer=new BABYLON.HighlightLayer("hl-"+i,this._scene,{alphaBlendingMode:BABYLON.Engine.ALPHA_ADD,mainTextureFixedSize:4096,blurTextureSizeRatio:.5,blurHorizontalSize:30,blurVerticalSize:30,isStroke:!0}),this._highlightLayer.outerGlow=!1,this._highlightLayer.innerGlow=!0,this._environmentSettings&&(this._environment=new DCEnvironmentHelper(this._scene,this._environmentSettings)),this._cameraSettings&&(this._camera=new DCCamera(this)),this._view=e.registerView(t,this.scene.activeCamera),this.loadFiles().then(()=>{r&&this.registerOnMeshSelection(r.callback,r.selectionOutlineColor,r.zoomSelectedMesh)})}resetScene(){this.startScene(this._engine,this._canvas,this._id,this._showFps,this._environmentSettings,this._cameraSettings,this._assetsPath,this._registerOnMeshSelection)}addInfopoints(e,t,i,s=null){this._infopoints=new DCInfopoints(this,e,t,i,s),this._infopoints.clickedInfopoint=(e=>{this.clickedInfopoint(e)})}infopointsToggleVisibility(e=null){this._infopoints.toggleVisibility(e)}addGui(e,t,i=DC_GUI_TYPE.ShowHideElements,s=null,n=null){this._gui=new DCGui(this,e,t,i,s,n)}loadFiles(){return __awaiter(this,void 0,void 0,function*(){if(this._assetsPath.length)for(let t=0;t<this._assetsPath.length;t++){var e=this._assetsPath[t].split(".").pop();"jpg"==e||"png"==e?yield this.loadTexture(this._assetsPath[t]):"mtl"==e?yield this.loadMTLFile(this._assetsPath[t]):"obj"==e||"glb"==e||"gltf"==e||"stl"==e?yield this.loadObject(this._assetsPath[t]):console.error("Fileextension: "+e+" is not supported")}})}loadObject(e){return __awaiter(this,void 0,void 0,function*(){this._startedResolve();const t=yield BABYLON.SceneLoader.ImportMeshAsync("","./",e,this._scene);return t.meshes.length?(this._camera.setCameraTarget(t.meshes),t.meshes):[]})}loadTexture(e){}loadMTLFile(e){this._startedResolve();let t=new BABYLON.MTLFileLoader;t.parseMTL(this._scene,e,"./",null)}takeScreenshot(e,t=this._scene._activeCamera){return __awaiter(this,void 0,void 0,function*(){return this._scene.render(),yield BABYLON.Tools.CreateScreenshotUsingRenderTargetAsync(this._engine,t,e,void 0,void 0,!0)})}}class DCBabylonJsViewer{constructor(){this._sceneSlots=[];let e=document.createElement("canvas");this._engine=new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0}),window.addEventListener("resize",()=>{this._engine.resize()}),this._engine.runRenderLoop(()=>{if(void 0!==this._engine.activeView&&this._sceneSlots.length){var e=this._sceneSlots.filter(e=>e.isFullscreen);if(e.length)e[0].scene.render(),this.createFPS(e[0]);else for(let e=0;e<this._sceneSlots.length;e++){let t=this._sceneSlots[e];this.isInViewport(t.sceneContainer)&&this._engine.activeView.target===t.canvas&&(t.scene.render(),this.createFPS(t))}}})}get engine(){return this._engine}isInViewport(e){const{top:t,bottom:i}=e.getBoundingClientRect(),s=window.innerHeight||document.documentElement.clientHeight;return(t>0||i>0)&&t<s}createFPS(e){if(e.showFps){var t=e.canvas.parentNode,i=this._engine.getFps().toFixed()+" fps";if(!t.querySelectorAll(".dc-fps-viewer").length){let e=document.createElement("div");e.style.position="absolute",e.style.right="2rem",e.style.top="2rem",e.style.zIndex="99",e.classList.add("dc-fps-viewer"),t.appendChild(e)}t.querySelectorAll(".dc-fps-viewer")[0].innerHTML=i}}addScene(e,t,i,s=null,n=null,a=!1,o=null){let r=new DCSceneSlot(e,t,this._engine,(this._sceneSlots.length+1).toString(),i,s,n,a,o);return this._sceneSlots.push(r),r.canvas.addEventListener("wheel",e=>e.preventDefault()),r.canvas.addEventListener("mouseenter",e=>{this._sceneSlots.forEach(e=>{e.camera.camera.detachControl(),e.scene.detachControl()}),this._engine.inputElement=r.canvas,r.camera.attachControl(),r.scene.activeCamera=r.camera.camera,r.scene.attachControl()}),void 0!==this.loadingFinished&&r.loadingFinished.then(()=>{this.loadingFinished(e)}),void 0!==this.loadingStarted&&r.loadingStarted.then(()=>{this.loadingStarted(e)}),r}resize(){this.engine&&this.engine.resize()}}export{DCBabylonJsViewer,DCCamera,DCCameraSettingsModel,DCEnvironmentHelper,DCEnvironmentSettingsModel,DCGui,DCGuiOptions,DCInfopointClickReturnModel,DCInfopointImagePathModel,DCInfopointOptionsModel,DCInfopoints,DCSceneSlot,DC_GUI_TYPE,DC_INFOPOINTS_TYPE};