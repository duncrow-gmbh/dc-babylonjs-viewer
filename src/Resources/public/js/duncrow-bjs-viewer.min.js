function __awaiter(e,t,i,s){function n(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):n(e.value).then(o,r)}l((s=s.apply(e,t||[])).next())})}class DCCamera{constructor(e){this._scene=e,this._canvas=this._scene.canvas,this._cameraSettings=this._scene.cameraSettings,this._camera=new BABYLON.ArcRotateCamera("Camera-"+this._scene.id,0,0,0,BABYLON.Vector3.Zero(),this._scene.scene),this._usedMeshesList=this._scene.usedMeshesList,this._camera.attachControl(this._canvas),this._camera.setPosition(new BABYLON.Vector3(0,1,2)),this._camera.alpha=1,this._camera.useFramingBehavior=!0;const t=Math.PI/180;this._cameraSettings&&(this._cameraSettings.radius&&(this._camera.radius=this._cameraSettings.radius),this._cameraSettings.upperVerticalAngelLimit&&(this._camera.lowerBetaLimit=Math.PI/2-t*this._cameraSettings.upperVerticalAngelLimit),this._cameraSettings.lowerVerticalAngelLimit&&(this._camera.upperBetaLimit=Math.PI/2+t*this._cameraSettings.lowerVerticalAngelLimit),this._cameraSettings.upperHorizontalAngelLimit&&(this._camera.upperAlphaLimit=this._camera.alpha+t*this._cameraSettings.upperHorizontalAngelLimit),this._cameraSettings.lowerHorizontalAngelLimit&&(this._camera.lowerAlphaLimit=this._camera.alpha+t*this._cameraSettings.lowerHorizontalAngelLimit),this._cameraSettings.panningSensibility&&(this._camera.panningSensibility=this._cameraSettings.panningSensibility),this._cameraSettings.wheelPrecision&&(this._camera.wheelPrecision=this._cameraSettings.wheelPrecision),this._cameraSettings.useAutoRotationBehavior&&(this._camera.useAutoRotationBehavior=this._cameraSettings.useAutoRotationBehavior),this._cameraSettings.rotationSpeed&&(this._camera.autoRotationBehavior.idleRotationSpeed=this._cameraSettings.rotationSpeed),this._cameraSettings.minZ&&(this._camera.minZ=this._cameraSettings.minZ),this._cameraSettings.maxZ&&(this._camera.maxZ=this._cameraSettings.maxZ)),this._initCameraPosition=this._camera.position}get camera(){return this._camera}set camera(e){this._camera=e}get initCameraPosition(){return this._initCameraPosition}set initCameraPosition(e){this._initCameraPosition=e}attachControl(){this._camera.attachControl(this._canvas,!0)}setCameraTarget(e){this._sceneTargets=e,this._camera.focusOn(e,!0),this._camera.zoomOn(e,!0),this._cameraSettings&&this._camera.radius&&(this._cameraSettings.minZoom&&(this._camera.lowerRadiusLimit=this._camera.radius*this._cameraSettings.minZoom),this._cameraSettings.maxZoom&&(this._camera.upperRadiusLimit=this._camera.radius*this._cameraSettings.maxZoom)),this._initAlpha=Object.assign({},this._camera).alpha,this._initBeta=Object.assign({},this._camera).beta,this._initRadius=Object.assign({},this._camera).radius,this._initTarget=this._camera.target.clone()}targAnimEnded(){}animateCameraTargetToPosition(e,t,i,s,n="target"){var a=new BABYLON.CubicEase;a.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT);var o=s;void 0!==s.x&&(o=new BABYLON.Vector3(-s.x,s.y,s.z)),BABYLON.Animation.CreateAndStartAnimation("at5",e,n,t,i,e[n],o,0,a,this.targAnimEnded)}refocusCamera(e){var t=this._sceneTargets;e&&(t=e);var i=200,s=200;this.animateCameraTargetToPosition(this._camera,i,s,t[0].position),!e&&this._cameraSettings&&this._camera.radius&&(this._cameraSettings.minZoom&&(this._camera.lowerRadiusLimit=this._camera.radius*this._cameraSettings.minZoom),this._cameraSettings.maxZoom&&(this._camera.upperRadiusLimit=this._camera.radius*this._cameraSettings.maxZoom))}zoomOnMeshes(e=null){var t=e;e&&e.length||(t=this._scene.scene.meshes.filter(e=>this._usedMeshesList.indexOf(e.id)>-1),t&&t.length||(t=this._sceneTargets));const i=new BABYLON.FramingBehavior;i.framingTime=750,this._camera.addBehavior(i),i.zoomOnMeshesHierarchy(t)}resetCamera(){var e=90,t=this.setCameraAnimation("radius",this._initRadius,e),i=this.setCameraAnimation("alpha",this._initAlpha,e),s=this.setCameraAnimation("beta",this._initBeta,e),n=this.setCameraAnimation("target",this._initTarget,e);this._scene.scene.beginDirectAnimation(this._camera,[t,i,s,n],0,e,!1)}setCameraAnimation(e,t,i){let s=new BABYLON.Animation(e+"Animation",e,i,"target"==e?BABYLON.Animation.ANIMATIONTYPE_VECTOR3:BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);var n=new BABYLON.CircleEase;n.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),s.setEasingFunction(n);let a=[];return a.push({frame:0,value:"target"==e?this._camera[e].clone():this._camera[e]}),a.push({frame:i,value:t}),s.setKeys(a),s}}class DCEnvironmentHelper{constructor(e,t){if(t){let i={createGround:this.parseValue(t,"createGround",!0),groundSize:this.parseValue(t,"groundSize",50),createSkybox:this.parseValue(t,"createSkybox",!0),skyboxSize:this.parseValue(t,"skyboxSize",400),skyboxColor:this.parseValue(t,"skyboxColor",BABYLON.Color3.Gray()),groundColor:this.parseValue(t,"groundColor",BABYLON.Color3.White()),groundShadowLevel:this.parseValue(t,"groundShadowLevel",0),setupImageProcessing:this.parseValue(t,"setupImageProcessing",!1),cameraContrast:this.parseValue(t,"cameraContrast",1.6),cameraExposure:this.parseValue(t,"cameraExposure",.6)};this._environment=e.createDefaultEnvironment(i),void 0!==t.backgroundColor&&(e.clearColor=t.backgroundColor)}}parseValue(e,t,i){return t in e?null==e[t]?null:e[t]:i}}var DC_GUI_TYPE,DC_INFOPOINTS_TYPE;(function(e){e[e.ShowHideElements=0]="ShowHideElements",e[e.AnimationElements=1]="AnimationElements",e[e.CustomElements=2]="CustomElements"})(DC_GUI_TYPE||(DC_GUI_TYPE={}));class DCGui{constructor(e,t,i,s=DC_GUI_TYPE.ShowHideElements,n=null,a=null){var o,r,l,c,d,h,m,u,v,_,g,p,C,f,S,w;this._class="show-hide-checkbox",this._scene=e,this._container=t,this._id=i;var E="input";if(s===DC_GUI_TYPE.ShowHideElements){E="input";var L=this._scene.scene.meshes.filter(e=>this._scene.usedMeshesList.indexOf(e.id)>-1);if(L.length){this._showHideAllId="dc-"+this._id+"-showhide-all",this.createElement(E,this._showHideAllId,"show-hide-all");for(let e=0;e<L.length;e++){var b="dc-"+this._id+"-showhide-"+e;t.appendChild(this.createElement(E,b,L[e].name))}}}else if(s===DC_GUI_TYPE.AnimationElements){E="button",this._class="play-stop-animation";var y=this._scene.scene.animationGroups;y.length&&y.filter(e=>e.name.includes("camera_")).forEach((i,s)=>{var a="dc-"+this._id+"-animation-"+s;t.appendChild(this.createElement(E,a,i.name,null,n.animationGroup)),i.targetedAnimations.forEach(t=>{t.target=e.scene.activeCamera}),i.metadata="test",i.onAnimationEndObservable.add((e,t)=>{var i=e.animation.name.replace(/(_channel[0-9]*)/,""),s=this._scene.scene.animationGroups.indexOf(this._scene.scene.animationGroups.find(e=>e.name==i));if(s>-1){var n=this._container.querySelectorAll("."+this._class);void 0!==n[s]&&n[s].classList.remove("playing")}})})}else if(s===DC_GUI_TYPE.CustomElements&&n.options.length){var M=document.createElement("div");M.classList.add("dc-scroll-main-container-"+this._id),M.classList.add("dc-scroll-main-container"),void 0!==n.infopointType&&M.setAttribute("dc-controll-type",n.infopointType),void 0!==n.id&&M.setAttribute("dc-controll-id",n.id);var A=document.createElement("label");if(void 0!==n.title&&A.appendChild(document.createTextNode(n.title)),void 0===n.type||"checkbox"!=n.type){var I=document.createElement("div");I.className="dc-scroll-container hidden";var O=document.createElement("div");O.classList.add("inner");var k=document.createElement("div");k.className="dc-selected";var T=document.createElement("div");T.className="dc-swiper";var P=document.createElement("div");P.className="swiper-wrapper";for(let e=0;e<5;e++)if(n&&void 0!==n.options&&n.options.length)for(let e=0;e<n.options.length;e++){var B=document.createElement("div");B.className="swiper-slide swiper-element-"+e,B.innerHTML='<div class="inner">'+((null===(o=n.options[e])||void 0===o?void 0:o.background)?`<div class="dc-swiper-symbol background-container ${(null===(r=n.options[e])||void 0===r?void 0:r.backgroundType)?"type-"+(null===(l=n.options[e])||void 0===l?void 0:l.backgroundType):""}"><div class="inner" style="background: ${n.options[e].background}" /></div></div>`:"")+((null===(c=n.options[e])||void 0===c?void 0:c.imagePath)?`<div class="dc-swiper-symbol image-container"><img src="${n.options[e].imagePath}" /></div>`:"")+`<div class="text-container"><span>${null===(d=n.options[e])||void 0===d?void 0:d.text}</span></div>`+"</div>",void 0!==n.options[e].action&&void 0!==n.options[e].action.change&&void 0!==n.options[e].action.target&&(B.setAttribute("dc-type",n.options[e].action.change),B.setAttribute("dc-target",n.options[e].action.target),void 0!==n.options[e].action.limitMeshes&&B.setAttribute("dc-limitmeshes",n.options[e].action.limitMeshes),void 0!==n.options[e].action.set&&B.setAttribute("dc-target-set",n.options[e].action.set)),P.appendChild(B)}this._container.appendChild(M),M.appendChild(I),M.appendChild(A),M.appendChild(k);var x=A.cloneNode(!0);x.classList.add("dc-swiper-label"),x.innerHTML=x.innerHTML+'<div class="dc-btn-close close-dc-select">&#10006;</div>',I.appendChild(x),I.appendChild(O),O.appendChild(T),T.appendChild(P);var N=M.querySelector(" .dc-selected");N.addEventListener("click",e=>{Array.from(M.querySelectorAll(" .dc-scroll-container")).forEach(e=>e.classList.add("hidden"));var t=M.querySelector(" .dc-scroll-container");t.classList.remove("hidden"),a(M)},!1)}else if((null===(h=null==n?void 0:n.options)||void 0===h?void 0:h.length)&&(null==n?void 0:n.options[0])&&(null==n?void 0:n.options[1])&&void 0!==(null===(m=null==n?void 0:n.options[0])||void 0===m?void 0:m.imagePath)&&void 0!==(null===(u=null==n?void 0:n.options[1])||void 0===u?void 0:u.imagePath)){var D=this.createElement("input","dc-checkbox-"+this._id,null==n?void 0:n.title,{checkedImagePath:null===(v=null==n?void 0:n.options[0])||void 0===v?void 0:v.imagePath,uncheckedImagePath:null===(_=null==n?void 0:n.options[1])||void 0===_?void 0:_.imagePath});void 0!==(null===(p=null===(g=null==n?void 0:n.options[0])||void 0===g?void 0:g.action)||void 0===p?void 0:p.target)&&D.setAttribute("dc-target",n.options[0].action.target),void 0!==(null===(f=null===(C=null==n?void 0:n.options[0])||void 0===C?void 0:C.action)||void 0===f?void 0:f.set)&&D.setAttribute("dc-target-set-checked",n.options[0].action.set),void 0!==(null===(w=null===(S=null==n?void 0:n.options[1])||void 0===S?void 0:S.action)||void 0===w?void 0:w.set)&&D.setAttribute("dc-target-set-unchecked",n.options[1].action.set);var Y=D.closest(".dc-checkbox-container");void 0!==n.infopointType&&Y.setAttribute("dc-controll-type",n.infopointType),void 0!==n.id&&Y.setAttribute("dc-controll-id",n.id),Y.classList.remove("unchecked","checked"),Y.classList.add(D.checked?"checked":"unchecked"),D.addEventListener("change",e=>{var t,i,s,o,r,l,c,d;if(void 0!==(null===(i=null===(t=null==n?void 0:n.options[0])||void 0===t?void 0:t.action)||void 0===i?void 0:i.target)&&void 0!==(null===(o=null===(s=null==n?void 0:n.options[0])||void 0===s?void 0:s.action)||void 0===o?void 0:o.set)&&void 0!==(null===(l=null===(r=null==n?void 0:n.options[1])||void 0===r?void 0:r.action)||void 0===l?void 0:l.set)){var h=null===(d=null===(c=null==n?void 0:n.options[0])||void 0===c?void 0:c.action)||void 0===d?void 0:d.target.split(",");h&&h.length&&h.forEach(e=>{this._scene.scene.getMeshById(e).isVisible=D.checked})}Y.classList.remove("unchecked","checked"),Y.classList.add(D.checked?"checked":"unchecked"),a(Y)},!1),this._container.appendChild(M),M.appendChild(A),M.appendChild(Y)}}}openGuiSlider(e,t,i=null,s=null,n=null){Array.from(this._container.querySelectorAll(".dc-scroll-container")).forEach(e=>e.classList.add("hidden"));var a,o=Array.from(this._container.querySelectorAll('[dc-controll-type="'+t+'"][dc-controll-id="'+e+'"] .dc-scroll-container'));o.length&&(a=o[0],s&&n&&(a.style.left=s+"px",a.style.top=n+"px",a.style.position="fixed",a.style.width="250px",a.style.transform="none"),a.classList.remove("hidden"),i(a.closest(".dc-scroll-main-container")))}createElement(e,t,i,s=null,n=null){var a,o,r=document.createElement(e);if(r.type="input"==e?"checkbox":"button",r.classList.add(t),r.classList.add(this._class),r.name=t,r.value=i,s){if(r.checked=!0,void 0!==s.checkedImagePath&&s.checkedImagePath){a=document.createElement("div"),a.classList.add("dc-image-container");var l=document.createElement("img");l.src=s.checkedImagePath,a.classList.add("checked-image"),a.appendChild(l)}if(void 0!==s.uncheckedImagePath&&s.uncheckedImagePath){o=document.createElement("div"),o.classList.add("dc-image-container");var c=document.createElement("img");c.src=s.uncheckedImagePath,o.classList.add("unchecked-image"),o.appendChild(c)}}else if("input"==e)r.checked=!0,r.addEventListener("change",e=>this.hideShowElements(e),!1);else if("button"==e){r.textContent=i;var d=n.find(e=>e.cameraName==i);void 0!==d&&r.addEventListener("click",e=>this.animationStartStop(e,d),!1)}var h=document.createElement("span");h.appendChild(document.createTextNode(i));var m=document.createElement("label");m.appendChild(h);var u=document.createElement("div");return u.classList.add(t+"-container"),u.classList.add("dc-checkbox-container"),m.appendChild(r),a&&m.appendChild(a),o&&m.appendChild(o),u.appendChild(m),r}hideShowElements(e){var t=this._scene.scene.meshes,i=this._container.querySelectorAll("."+this._class);if(e.target.className.includes(this._showHideAllId)){t.map(t=>t.isVisible=e.target.checked);for(var s=0;s<i.length;s++)i[s].checked=e.target.checked}else for(s=0;s<i.length;s++)"show-hide-all"!=i[s].value&&(t.find(e=>e.id==i[s].value).isVisible=i[s].checked)}animationStartStop(e,t){this._scene.scene.animationGroups.forEach((e,t)=>{e.stop()}),t.animationGroups.forEach(t=>{var i=this._scene.scene.animationGroups.find(e=>e.name==t);void 0!==i&&(i.isStarted?(i.stop(),e.target.classList.remove("playing")):(i.play(),e.target.classList.add("playing")))})}}(function(e){e.visibility="visibility",e.zoom="zoom",e.info="info",e.color="color"})(DC_INFOPOINTS_TYPE||(DC_INFOPOINTS_TYPE={}));class DCInfopoints{constructor(e,t,i,s,n=null){this._imageButtons=[],this._scene=e,this._advancedTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,this._scene.scene);for(let e=0;e<this._scene.scene.meshes.length;e++){var a=this._scene.scene.meshes[e];if(a.id.includes(t)){a.isVisible=!1;let e="",t=i.indexOf(i.find(e=>a.id.includes(e.meshNamePattern)));t>-1&&(e=i[t].imagePath);var o=BABYLON.GUI.Button.CreateImageButton("dc-mesh-button-"+a.id,"",e);o.width=n&&(null==n?void 0:n.width)?n.width+"px":"54px",o.height=n&&(null==n?void 0:n.height)?n.height+"px":"54px",o.image.width=n&&(null==n?void 0:n.width)?n.width+"px":"54px",o.image.height=n&&(null==n?void 0:n.height)?n.height+"px":"54px",o.background="transparent",o.thickness=0,this._advancedTexture.addControl(o),o.linkWithMesh(a);var r=[],l="";const c=Object.keys(DC_INFOPOINTS_TYPE);c.forEach((e,t)=>{if(n&&void 0!==n[e]&&n[e].length&&n[e].filter(e=>a.id.includes(e)).length){l=a.id.replace(n[e].filter(e=>a.id.includes(e))[0]+"-","");var i=[DC_INFOPOINTS_TYPE[e]];r=[...new Set([...r,...i])]}}),this._imageButtons.push({button:o,imagePath:e,meshName:l,clickedType:r,active:!1}),this.bindButtonEvents(o,e,a,s,n,l,r)}}console.log("imagebuttons: ",this._imageButtons)}get advancedTexture(){return this._advancedTexture}toggleVisibility(e=null){let t=this._advancedTexture.getDescendants();t.forEach(t=>{t.isVisible=!0===e||!1!==e&&!t.isVisible})}activateInfopoint(e,t){var i=this._imageButtons.find(i=>i.clickedType.includes(e)&&i.meshName==t);if(void 0!==i&&i){var s=i.imagePath.split(".").pop();i.button.image.source=i.imagePath.replace("."+s,"")+"-active."+s,i.active=!0}}deactivateInfopoint(e=null,t=null){if(e&&t){var i=this._imageButtons.find(i=>i.clickedType.includes(e)&&i.meshName==t);void 0!==i&&i&&(i.button.image.source=i.imagePath,i.active=!1)}else this._imageButtons.forEach(e=>{e.active=!1,e.button.image.source=e.imagePath})}isActive(e,t){var i=t.filter(e=>e!==DC_INFOPOINTS_TYPE.zoom);if(i.length){var s=this._imageButtons.find(t=>t.clickedType.includes(i[0])&&t.meshName==e);if(void 0!==s&&s)return s.active}return!1}bindButtonEvents(e,t,i,s,n=null,a,o){var r=t.split(".").pop();e.onPointerEnterObservable.add(e=>{var i=this.isActive(a,o);void 0===e.image||i||(e.image.source=t.replace("."+r,"")+"-hover."+r)}),e.onPointerOutObservable.add(e=>{var i=this.isActive(a,o);void 0===e.image||i||(e.image.source=t)}),e.onPointerClickObservable.add(l=>{var c=this.isActive(a,o);this._imageButtons.forEach(e=>{e.active=!1,e.button.image.source=e.imagePath});var d=this._imageButtons.find(t=>t.button==e);if(e.image.source=c?t:t.replace("."+r,"")+"-active."+r,void 0!==d&&d&&(d.active=!c),o.includes(DC_INFOPOINTS_TYPE.zoom))for(let e=0;e<n.zoom.length;e++)if(i.id.includes(n.zoom[e])){var h=this._scene.camera;h.animateCameraTargetToPosition(h.camera,200,200,i.position),h.animateCameraTargetToPosition(h.camera,200,200,s,"radius")}if(o.includes(DC_INFOPOINTS_TYPE.visibility))for(let e=0;e<n.visibility.length;e++)if(i.id.includes(n.visibility[e])){var m=this._scene.scene.getMeshById(a);m&&(m.isVisible=!m.isVisible)}this.clickedInfopoint({mesh:i,targetMeshId:a,type:o,x:l.x,y:l.y})})}}class DCModal{constructor(e,t,i,s="",n=!1,a=!1,o=null,r=null,l=null,c=1280,d=720){this._copyElement=o,this._copyElementContainer=r,this._copyToContainer=l,this._viewer=e,this._scene=t,this._id=i,this.createModal(s,n,a,o,r,l,c,d)}get id(){return this._id}createModal(e="",t=!1,i=!1,s=null,n=null,a=null,o=1280,r=720){this.modal=document.createElement("div"),this.modal.id=this._id,this.modal.classList.add("dc-modal"),this._divModalContentContainer=document.createElement("div"),this._divModalContentContainer.classList.add("dc-modal-content-container");var l=document.createElement("div");l.classList.add("inner"),this._divModalClose=document.createElement("a"),this._divModalClose.classList.add("dc-btn-close"),this._divModalClose.innerHTML="&#10006;",this._divModalContent=document.createElement("div"),this._divModalContent.classList.add("dc-modal-content"),this._divModalImageContainer=document.createElement("div"),this._divModalImageContainer.classList.add("dc-modal-image-container");var c=document.createElement("div");return c.classList.add("dc-image-container"),this._divModalImage=document.createElement("img"),this._divModalImage.classList.add("dc-renderimage"),this._divModalDownload=document.createElement("a"),this._divModalDownload.classList.add("dc-download"),this._divModalDownload.innerHTML="Download",this.modal.appendChild(this._divModalContentContainer),this._divModalContentContainer.appendChild(l),l.appendChild(this._divModalClose),l.appendChild(this._divModalContent),l.appendChild(this._divModalImageContainer),this._divModalImageContainer.appendChild(c),c.appendChild(this._divModalImage),this._divModalImageContainer.appendChild(this._divModalDownload),this.show(e,t,i,s,a,o,r),this.modal}screenshot(e,t){return __awaiter(this,void 0,void 0,function*(){var i=yield this._scene.takeScreenshot({width:e,height:t});this._divModalImage.src=i,this._divModalDownload.href=i,this._divModalDownload.download="screenshot.png"})}show(e="",t=!1,i=!1,s=null,n=null,a=1280,o=720){var r=document.querySelector("body");this._divModalContent.innerHTML="",""!=e&&(this._divModalContent.innerHTML="<h3>"+e+"</h3>"),!0===i?(this.screenshot(a,o),this._divModalImageContainer.classList.remove("hidden")):this._divModalImageContainer.classList.add("hidden"),!0===t?(r.prepend(this.modal),r.classList.add("dc-modal-active"),this._scene.isFullscreen=!0,this._divModalContentContainer.classList.add("fullscreen")):n&&(n.appendChild(this.modal),n.classList.add("modal-added")),s&&this._divModalContent.appendChild(s),this._divModalClose&&this._divModalClose.addEventListener("click",e=>{e.preventDefault(),this.hide()}),setTimeout(()=>{this._viewer.resize()},40),this.modal.classList.add("fadeIn")}hide(){this._divModalContentContainer.classList.remove("fullscreen");var e=document.querySelector("body");this._copyElement&&this._copyElementContainer&&(this._copyElementContainer.appendChild(this._copyElement),setTimeout(()=>{this._viewer.resize()},40)),this._copyToContainer&&this._copyToContainer.classList.remove("modal-added"),e.classList.remove("dc-modal-active"),this._scene.isFullscreen=!1,this.modal.classList.remove("fadeIn")}remove(){this.modal.parentNode.removeChild(this.modal)}}class DCCameraSettingsModel{constructor(){this.panningSensibility=1e3,this.wheelPrecision=100,this.useAutoRotationBehavior=!1,this.rotationSpeed=.1}}class DCEnvironmentSettingsModel{constructor(){this.createGround=!1,this.groundSize=50,this.createSkybox=!1}}class DCGuiOptions{}class DCInfopointClickReturnModel{}class DCInfopointImagePathModel{}class DCInfopointOptionsModel{}class DCSceneSlot{constructor(e,t,i,s,n,a,o=null,r=!1,l=null,c="",d){this.isFullscreen=!1,this.loadingStarted=new Promise((e,t)=>{this._startedResolve=e,this._startedReject=e}),this.loadingFinished=new Promise((e,t)=>{this._finishedResolve=e,this._finishedReject=e}),this.sceneCallbacks={addMaterial:function(e,t){for(let t of e._scene.materials)if(e!=t&&e.id==t.id)throw new Error("material with id already exists"+e.id)},addMesh:function(e,t){for(let t of e._scene.meshes)if(e!=t&&e.id==t.id)throw new Error("mesh with id already exists "+e.id)},addLight:function(e,t){for(let t of e._scene.lights)if(e!=t&&e.id==t.id)throw new Error("light with id already exists "+e.id)}},this._blacklist=["BackgroundHelper","BackgroundPlane","BackgroundSkybox"],this._whitelist=[],this._usedMeshesList=[],this._userInteractionEnabled=!0,this._engine=i,this._canvas=e,this._id=s,this._showFps=r,this._environmentSettings=o,this._cameraSettings=a,this._assetsPath=n,this._registerOnMeshSelection=l,this._environmentTexturePath=c,this._activateCanvas=d,this._sceneContainer=document.querySelector(t),this.startScene()}get environmentTexturePath(){return this._environmentTexturePath}get sceneContainer(){return this._sceneContainer}get infopoints(){return this._infopoints}get gui(){return this._gui}get cameraSettings(){return this._cameraSettings}get environment(){return this._environment}get showFps(){return this._showFps}get engine(){return this._engine}get canvas(){return this._canvas}get scene(){return this._scene}get camera(){return this._camera}get id(){return this._id}get view(){return this._view}registersceneCallbacks(){this._scene.onNewMaterialAddedObservable.add(this.sceneCallbacks.addMaterial),this._scene.onNewMeshAddedObservable.add(this.sceneCallbacks.addMesh),this._scene.onNewLightAddedObservable.add(this.sceneCallbacks.addLight)}get blacklist(){return this._blacklist}set blacklist(e){e.length?(this._blacklist=[...new Set([...this._blacklist,...e])],this.setUsedMeshesList()):this._blacklist=[]}get whitelist(){return this._whitelist}set whitelist(e){e.length?(this._whitelist=[...new Set([...this._whitelist,...e])],this.setUsedMeshesList()):this._whitelist=[]}get usedMeshesList(){return this._usedMeshesList}set usedMeshesList(e){this._usedMeshesList=e}setUsedMeshesList(){this._usedMeshesList=[];var e=this._scene.meshes;if(e.length)for(let t=0;t<e.length;t++)this._whitelist.length&&!(this._whitelist.indexOf(e[t].id)>-1)||this._blacklist.length&&this._blacklist.find(i=>e[t].id.toLowerCase().includes(i.toLowerCase()))||this._usedMeshesList.push(e[t].id)}get userInteractionEnabled(){return this._userInteractionEnabled}set userInteractionEnabled(e){this._userInteractionEnabled=e,this._scene&&this._scene.activeCamera&&(this._userInteractionEnabled?this._scene.activeCamera.attachControl(this._canvas):this._scene.activeCamera.detachControl(this._canvas))}registerOnMeshSelection(e,t,i){this._scene.onPointerDown=((s,n)=>{if(e)if(this._highlightLayer.removeAllMeshes(),n.hit&&!this._blacklist.includes(n.pickedMesh.name)){if(e({meshName:n.pickedMesh.name,mouseAttributes:{x:s.clientX,y:s.clientY,mouseButton:s.button}}),t){const e=this._scene.meshes.find(e=>e.id==n.pickedMesh.id);i&&e&&this._camera.zoomOnMeshes([e]),this._highlightLayer.addMesh(e,t)}}else this._camera.zoomOnMeshes(),e({meshName:void 0,mouseAttributes:{x:s.clientX,y:s.clientY,mouseButton:s.button}});else n.hit&&!this._blacklist.includes(n.pickedMesh.name)||this._camera.zoomOnMeshes()})}unregisterOnMeshSelection(){this._scene.onPointerDown=null,this._highlightLayer.removeAllMeshes()}get backgroundColor(){return this._scene.clearColor}set backgroundColor(e){this._scene.clearColor=e}startScene(){if(this._scene=new BABYLON.Scene(this._engine),this._scene.createDefaultLight(),this.registersceneCallbacks(),this._environmentTexturePath){var e=BABYLON.CubeTexture.CreateFromPrefilteredData(this._environmentTexturePath,this._scene);e.gammaSpace=!1,this._scene.environmentTexture=e}this._highlightLayer=new BABYLON.HighlightLayer("hl-"+this._id,this._scene,{alphaBlendingMode:BABYLON.Engine.ALPHA_ADD,mainTextureFixedSize:4096,blurTextureSizeRatio:.5,blurHorizontalSize:30,blurVerticalSize:30,isStroke:!0}),this._highlightLayer.outerGlow=!1,this._highlightLayer.innerGlow=!0,this._environmentSettings&&(this._environment=new DCEnvironmentHelper(this._scene,this._environmentSettings)),this._cameraSettings&&(this._camera=new DCCamera(this)),this._view=this._engine.registerView(this._canvas,this.scene.activeCamera),this.loadFiles().then(()=>{this._registerOnMeshSelection&&this.registerOnMeshSelection(this._registerOnMeshSelection.callback,this._registerOnMeshSelection.selectionOutlineColor,this._registerOnMeshSelection.zoomSelectedMesh)}),this._canvas.parentNode.addEventListener("click",e=>{this._activateCanvas(this)}),this._scene.onReadyObservable.add((e,t)=>{this.setUsedMeshesList(),this._finishedResolve(),this._scene.blockMaterialDirtyMechanism=!0,this._scene.meshes.forEach(e=>{e.doNotSyncBoundingInfo=!0,e.freezeWorldMatrix()}),this._scene.materials.forEach(e=>{e.freeze()}),this._scene.animationGroups.forEach((e,t)=>{e.stop()})})}resetScene(){this.startScene()}addInfopoints(e,t,i,s=null){this._infopoints=new DCInfopoints(this,e,t,i,s),this._infopoints.clickedInfopoint=(e=>{this.clickedInfopoint(e)})}deactivateInfoPoints(e=null,t=null){void 0!==this._infopoints&&this._infopoints&&this._infopoints.deactivateInfopoint(e,t)}activateInfoPoints(e,t){void 0!==this._infopoints&&this._infopoints&&this._infopoints.activateInfopoint(e,t)}infopointsToggleVisibility(e=null){void 0!==this._infopoints&&this._infopoints&&this._infopoints.toggleVisibility(e)}addGui(e,t,i=DC_GUI_TYPE.ShowHideElements,s=null,n=null){this._gui=new DCGui(this,e,t,i,s,n)}loadFiles(){return __awaiter(this,void 0,void 0,function*(){if(this._assetsPath.length)for(let t=0;t<this._assetsPath.length;t++){var e=this._assetsPath[t].split(".").pop();"jpg"==e||"png"==e?yield this.loadTexture(this._assetsPath[t]):"mtl"==e?yield this.loadMTLFile(this._assetsPath[t]):"obj"==e||"glb"==e||"gltf"==e||"stl"==e?yield this.loadObject(this._assetsPath[t]):console.error("Fileextension: "+e+" is not supported")}})}loadObject(e){return __awaiter(this,void 0,void 0,function*(){this._startedResolve();const t=yield BABYLON.SceneLoader.ImportMeshAsync("","./",e,this._scene);return t.meshes.length?(this._camera.setCameraTarget(t.meshes),t.meshes):[]})}loadTexture(e){}loadMTLFile(e){this._startedResolve();let t=new BABYLON.MTLFileLoader;t.parseMTL(this._scene,e,"./",null)}takeScreenshot(e,t=this._scene._activeCamera){return __awaiter(this,void 0,void 0,function*(){return this._scene.render(),yield BABYLON.Tools.CreateScreenshotUsingRenderTargetAsync(this._engine,t,e,void 0,void 0,!0)})}}class DCBabylonJsViewer{constructor(){this._modals=[],this._sceneSlots=[],this._activeScenes=[];let e=document.createElement("canvas");this._engine=new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0},!1),this._engine.runRenderLoop(()=>{if(this._activeScenes.length)for(let e=0;e<this._activeScenes.length;e++)this._engine.activeView.target===this._activeScenes[e].canvas&&(this._activeScenes[e].scene.render(),this.createFPS(this._activeScenes[e]))}),window.addEventListener("resize",()=>{this._engine.resize()});var t=0;window.addEventListener("scroll",()=>{var e="down",i=window.pageYOffset||document.documentElement.scrollTop;e=i>t?"down":"up",t=i<=0?0:i,this.setActiveScenes(e)}),window.addEventListener("load",e=>{this.setActiveScenes("down")}),document.addEventListener("keydown",e=>{if(this._modals.length&&"Escape"===e.key){const t=!(e.ctrlKey||e.altKey||e.shiftKey);t&&(console.log("Escape key was pressed with out any group keys"),this._modals.forEach(e=>{e.hide()}))}})}get modals(){return this._modals}get engine(){return this._engine}get sceneSlots(){return this._sceneSlots}setActiveScenes(e){var t=!1,i=[],s=this._sceneSlots.filter(e=>e.isFullscreen);if(s.length)-1===i.indexOf(s[0])&&i.push(s[0]);else for(let e=0;e<this._sceneSlots.length;e++){let t=this._sceneSlots[e];this.isInViewport(t.sceneContainer)&&-1===i.indexOf(t)&&i.push(t)}if(i.length!==this._activeScenes.length)this._activeScenes=[...i],t=!0;else{var n=!1;this._activeScenes.forEach(e=>{-1===i.indexOf(e)&&(n=!0)}),n&&(this._activeScenes=[...i],t=!0)}t&&this.updateRenderLoop(e)}updateRenderLoop(e){var t=this._sceneSlots.filter(e=>-1===this._activeScenes.indexOf(e));t.forEach(e=>{var t=this._engine.views.indexOf(e.view);t>-1&&(this._engine.views[t].enabled=!1)}),this._activeScenes.forEach(t=>{var i=this._engine.views.indexOf(t.view);i>-1&&(this._engine.views[i].enabled=!0),this.setActiveCanvas(e)})}setActiveCanvas(e,t=null){if(this._activeScenes.length){var i=0;i="down"==e?Math.ceil(this._activeScenes.length/2):Math.floor(this._activeScenes.length/2),t&&this._activeScenes.indexOf(t)>-1&&(i=this._activeScenes.indexOf(t)),document.querySelectorAll(".dc-canvas-3d").forEach(e=>{e.classList.remove("active")}),void 0===this._activeScenes[i]&&(i="down"==e?this._activeScenes.length-1:0),void 0!==this._activeScenes[i]&&(this._activeScenes[i].canvas.classList.add("active"),this._sceneSlots.forEach(e=>{e.scene.detachControl()}),this._engine.inputElement=this._activeScenes[i].canvas,this._activeScenes[i].scene.attachControl())}}isInViewport(e){const{top:t,bottom:i}=e.getBoundingClientRect(),s=window.innerHeight||document.documentElement.clientHeight;return(t>0||i>0)&&t<s}createFPS(e){if(e.showFps){var t=e.canvas.parentNode,i=this._engine.getFps().toFixed()+" fps";if(!t.querySelectorAll(".dc-fps-viewer").length){let e=document.createElement("div");e.style.position="absolute",e.style.right="2rem",e.style.top="2rem",e.style.zIndex="99",e.classList.add("dc-fps-viewer"),t.appendChild(e)}t.querySelectorAll(".dc-fps-viewer")[0].innerHTML=i}}addScene(e,t,i,s=null,n=null,a=!1,o=null,r=""){let l=new DCSceneSlot(e,t,this._engine,(this._sceneSlots.length+1).toString(),i,s,n,a,o,r,e=>{this.setActiveCanvas("down",e)});return this._sceneSlots.push(l),l.canvas.addEventListener("wheel",e=>e.preventDefault()),l.canvas.addEventListener("mouseenter",e=>{this._sceneSlots.forEach(e=>{e.camera.camera.detachControl(),e.scene.detachControl()}),this._engine.inputElement=l.canvas,l.camera.attachControl(),l.scene.activeCamera=l.camera.camera,l.scene.attachControl()}),void 0!==this.loadingFinished&&l.loadingFinished.then(()=>{this.loadingFinished(e)}),void 0!==this.loadingStarted&&l.loadingStarted.then(()=>{this.loadingStarted(e)}),l}createModal(e,t,i="",s=!1,n=!1,a=null,o=null,r=null,l=1280,c=720){if(document.querySelector("#"+t)){var d=this._modals.find(e=>e.id==t);d.show(i,s,n,a,r,l,c)}else this._modals.push(new DCModal(this,e,t,i,s,n,a,o,r,l,c))}resize(){this.engine&&this.engine.resize()}}export{DCBabylonJsViewer,DCCamera,DCCameraSettingsModel,DCEnvironmentHelper,DCEnvironmentSettingsModel,DCGui,DCGuiOptions,DCInfopointClickReturnModel,DCInfopointImagePathModel,DCInfopointOptionsModel,DCInfopoints,DCModal,DCSceneSlot,DC_GUI_TYPE,DC_INFOPOINTS_TYPE};